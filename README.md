# mini-HIS: é†«é™¢è³‡è¨Šç³»çµ±ç¤ºç¯„å°ˆæ¡ˆ

é€™æ˜¯ä¸€å€‹ä½¿ç”¨ TypeScript é–‹ç™¼çš„é†«é™¢è³‡è¨Šç³»çµ± (Hospital Information System) ç¤ºç¯„å°ˆæ¡ˆï¼Œæ—¨åœ¨å±•ç¤ºã€Œå…ˆå¯«é¡å‹å†å¯«é‚è¼¯ã€çš„é–‹ç™¼æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ä»£æ•¸è³‡æ–™é¡å‹ (Algebraic Data Types, ADT) ä¾†è¦ç¯„å’Œç°¡åŒ–ç¨‹å¼ç¢¼é‚è¼¯ã€‚

å°ˆæ¡ˆåŒ…å«å®Œæ•´çš„ **å‰å¾Œç«¯å¯¦ç¾**ï¼Œå‰ç«¯ä½¿ç”¨ **TailwindCSS** å’ŒåŸç”Ÿ JavaScriptï¼Œå¾Œç«¯ä½¿ç”¨ **Express.js** æä¾› RESTful APIã€‚

## åŠŸèƒ½ç‰¹è‰²

ğŸ¥ **å®Œæ•´çš„é†«é™¢å·¥ä½œæµç¨‹**
- ç—…æ‚£ç®¡ç†ï¼šè¨»å†Šã€å…¥é™¢ã€å‡ºé™¢
- é ç´„ç³»çµ±ï¼šé ç´„ã€ç¢ºèªã€å ±åˆ°ã€é–‹å§‹ã€å®Œæˆ
- è™•æ–¹ç®¡ç†ï¼šé–‹ç«‹ã€é€å‡ºã€èª¿åŠ‘ã€å®Œæˆã€ç™¼è—¥
- é†«ç™‚æœå‹™ï¼šè«‹æ±‚ã€æ’ç¨‹ã€æº–å‚™ã€åŸ·è¡Œã€å®Œæˆ

ğŸ”§ **æŠ€è¡“æ¶æ§‹**
- **å‰ç«¯**ï¼šHTML + TailwindCSS + åŸç”Ÿ JavaScript
- **å¾Œç«¯**ï¼šNode.js + Express.js + TypeScript
- **é¡å‹ç³»çµ±**ï¼šå®Œå…¨ä½¿ç”¨ TypeScript ADT å¯¦ç¾ç‹€æ…‹ç®¡ç†
- **æ¶æ§‹æ¨¡å¼**ï¼šRESTful API + ç‹€æ…‹æ©Ÿè¨­è¨ˆ

## é–‹ç™¼ç†å¿µ

### å…ˆå¯«é¡å‹å†å¯«é‚è¼¯

åœ¨å‚³çµ±é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘å¸¸å¸¸å…ˆè€ƒæ…®ç¨‹å¼çš„è¡Œç‚ºå’Œé‚è¼¯ï¼Œç„¶å¾Œæ‰å®šç¾©è³‡æ–™çµæ§‹ã€‚é€™ç¨®æ–¹å¼å®¹æ˜“å°è‡´é¡å‹ä¸ä¸€è‡´ã€é‚Šç•Œæƒ…æ³è™•ç†ä¸ç•¶ç­‰å•é¡Œã€‚åœ¨æœ¬å°ˆæ¡ˆä¸­ï¼Œæˆ‘å€‘å°‡æ¡ç”¨ç›¸åçš„æ–¹å¼ï¼š

1. **å…ˆå®šç¾©å®Œæ•´çš„é¡å‹ç³»çµ±**ï¼šåŒ…æ‹¬å¯¦é«”é¡å‹ã€ç‹€æ…‹é¡å‹ã€æ“ä½œçµæœé¡å‹ç­‰ã€‚
2. **åˆ©ç”¨é¡å‹ä¾†å¼•å°é‚è¼¯å¯¦ç¾**ï¼šè®“ç·¨è­¯å™¨å¹«åŠ©æˆ‘å€‘æª¢æŸ¥æ˜¯å¦è™•ç†äº†æ‰€æœ‰å¯èƒ½çš„æƒ…æ³ã€‚
3. **ä½¿ç”¨é¡å‹ä¾†è¡¨é”æ¥­å‹™è¦å‰‡**ï¼šå°‡æ¥­å‹™è¦å‰‡ç·¨ç¢¼åˆ°é¡å‹ç³»çµ±ä¸­ï¼Œè€Œä¸æ˜¯æ•£è½åœ¨å„è™•çš„æ¢ä»¶åˆ¤æ–·ã€‚

é€™ç¨®æ–¹æ³•æœ‰ä»¥ä¸‹å„ªé»ï¼š

- **ææ—©ç™¼ç¾éŒ¯èª¤**ï¼šåœ¨ç·¨è­¯æ™‚å°±èƒ½ç™¼ç¾è¨±å¤šæ½›åœ¨çš„éŒ¯èª¤ã€‚
- **è‡ªæ–‡æª”åŒ–**ï¼šé¡å‹å®šç¾©æœ¬èº«å°±æ˜¯ä¸€ç¨®æ–‡æª”ï¼Œæ¸…æ™°åœ°è¡¨é”äº†æ•¸æ“šçš„çµæ§‹å’Œç´„æŸã€‚
- **å¼•å°å¯¦ç¾**ï¼šé¡å‹å®šç¾©ç‚ºå¯¦ç¾æä¾›äº†æ˜ç¢ºçš„æŒ‡å°ï¼Œä½¿å¾—å¯¦ç¾æ›´åŠ ç›´è§€å’Œå¯é ã€‚
- **ä¿ƒé€²æ¨¡çµ„åŒ–**ï¼šæ¸…æ™°çš„é¡å‹é‚Šç•Œæœ‰åŠ©æ–¼è¨­è¨ˆæ›´åŠ æ¨¡çµ„åŒ–çš„ç³»çµ±ã€‚

### ä»£æ•¸è³‡æ–™é¡å‹ (ADT) çš„æ‡‰ç”¨

ä»£æ•¸è³‡æ–™é¡å‹æ˜¯å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆä¸­çš„é‡è¦æ¦‚å¿µï¼Œåœ¨ TypeScript ä¸­ä¸»è¦é€šéè¯åˆé¡å‹ (Union Types) å’Œä»‹é¢ (Interfaces) ä¾†å¯¦ç¾ã€‚æˆ‘å€‘å°‡ç‰¹åˆ¥é—œæ³¨ï¼š

1. **ç‹€æ…‹å»ºæ¨¡**ï¼šä½¿ç”¨æ¨™ç±¤è¯åˆé¡å‹ (Tagged Union Types) ä¾†è¡¨ç¤ºä¸åŒç‹€æ…‹ã€‚
2. **çµæœè™•ç†**ï¼šä½¿ç”¨ Result é¡å‹ä¾†è™•ç†å¯èƒ½çš„æˆåŠŸæˆ–å¤±æ•—æƒ…æ³ã€‚
3. **é¡å‹å®ˆè¡›**ï¼šä½¿ç”¨é¡å‹å®ˆè¡› (Type Guards) ä¾†å®‰å…¨åœ°è™•ç†ä¸åŒé¡å‹çš„å€¼ã€‚

ä¾‹å¦‚ï¼Œæˆ‘å€‘ä½¿ç”¨ ADT ä¾†è¡¨ç¤ºç—…æ‚£çš„ä¸åŒç‹€æ…‹ï¼š

```typescript
// ç—…æ‚£å¯èƒ½è™•æ–¼çš„ä¸åŒç‹€æ…‹
export type PatientState = 
  | Registered   // å·²æ›è™Ÿ
  | Admitted     // å·²å…¥é™¢
  | Discharged   // å·²å‡ºé™¢
  | Transferred; // å·²è½‰é™¢
```

é€šéé€™ç¨®æ–¹å¼ï¼Œæˆ‘å€‘å¯ä»¥ç¢ºä¿ç—…æ‚£åªèƒ½è™•æ–¼é€™äº›é å®šç¾©çš„ç‹€æ…‹ä¹‹ä¸€ï¼Œä¸¦ä¸”æ¯ç¨®ç‹€æ…‹éƒ½æœ‰å…¶ç‰¹å®šçš„å±¬æ€§å’Œè¡Œç‚ºã€‚

## å°ˆæ¡ˆçµæ§‹

```txt
mini-HIS/
â”œâ”€â”€ README.md         # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ public/           # å‰ç«¯éœæ…‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ index.html    # ä¸»é é¢ (ä½¿ç”¨ TailwindCSS CDN)
â”‚   â””â”€â”€ app.js        # å‰ç«¯ JavaScript é‚è¼¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types/        # é¡å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ common.ts # é€šç”¨é¡å‹
â”‚   â”‚   â””â”€â”€ results.ts # çµæœé¡å‹ (ADT)
â”‚   â”œâ”€â”€ models/       # æ¨¡å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ Patient.ts       # ç—…æ‚£ç®¡ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ Appointment.ts   # é ç´„ç³»çµ±æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ Prescription.ts  # è—¥ç‰©è™•æ–¹æ¨¡çµ„
â”‚   â”‚   â””â”€â”€ MedicalService.ts # é†«ç™‚æœå‹™æ¨¡çµ„
â”‚   â”œâ”€â”€ server.ts     # Express å¾Œç«¯æœå‹™å™¨
â”‚   â””â”€â”€ index.ts      # æ§åˆ¶å°ç¤ºç¯„ç¨‹å¼
â”œâ”€â”€ package.json      # Node.js å°ˆæ¡ˆé…ç½®
â””â”€â”€ tsconfig.json     # TypeScript é…ç½®
```

## å¦‚ä½•é‹è¡Œ

### ç’°å¢ƒéœ€æ±‚
- Node.js 20+
- TypeScript

### å®‰è£ä¾è³´

```bash
npm install
```

### é‹è¡Œæ–¹å¼

#### 1. ç¶²é æ‡‰ç”¨ç¨‹å¼ (æ¨è–¦)
```bash
npm run start
# æˆ–
npm run dev
```

è¨ªå• `http://localhost:5000` æŸ¥çœ‹å®Œæ•´çš„é†«é™¢è³‡è¨Šç³»çµ±ç¶²é ç•Œé¢ã€‚

#### 2. æ§åˆ¶å°ç¤ºç¯„ç¨‹å¼
```bash
npm run demo
```

é‹è¡Œæ§åˆ¶å°ç‰ˆæœ¬çš„å®Œæ•´é†«é™¢å·¥ä½œæµç¨‹ç¤ºç¯„ã€‚

## API ç«¯é»

### ç—…æ‚£ç®¡ç†
- `POST /api/patients` - è¨»å†Šæ–°ç—…æ‚£
- `GET /api/patients` - ç²å–æ‰€æœ‰ç—…æ‚£
- `GET /api/patients/:id` - ç²å–æŒ‡å®šç—…æ‚£
- `POST /api/patients/:id/admit` - ç—…æ‚£å…¥é™¢
- `POST /api/patients/:id/discharge` - ç—…æ‚£å‡ºé™¢

### é ç´„ç³»çµ±
- `POST /api/appointments` - å»ºç«‹æ–°é ç´„
- `GET /api/appointments` - ç²å–æ‰€æœ‰é ç´„
- `POST /api/appointments/:id/confirm` - ç¢ºèªé ç´„
- `POST /api/appointments/:id/checkin` - é ç´„å ±åˆ°
- `POST /api/appointments/:id/start` - é–‹å§‹é ç´„
- `POST /api/appointments/:id/complete` - å®Œæˆé ç´„

### è™•æ–¹ç®¡ç†
- `POST /api/prescriptions` - é–‹ç«‹æ–°è™•æ–¹
- `GET /api/prescriptions` - ç²å–æ‰€æœ‰è™•æ–¹
- `POST /api/prescriptions/:id/submit` - é€å‡ºè™•æ–¹
- `POST /api/prescriptions/:id/start-preparation` - é–‹å§‹èª¿åŠ‘
- `POST /api/prescriptions/:id/complete-preparing` - å®Œæˆèª¿åŠ‘
- `POST /api/prescriptions/:id/dispense` - ç™¼æ”¾è—¥ç‰©

### é†«ç™‚æœå‹™
- `POST /api/services` - è«‹æ±‚æ–°æœå‹™
- `GET /api/services` - ç²å–æ‰€æœ‰æœå‹™
- `POST /api/services/:id/schedule` - æ’ç¨‹æœå‹™
- `POST /api/services/:id/start-preparation` - é–‹å§‹æº–å‚™
- `POST /api/services/:id/start` - é–‹å§‹æœå‹™
- `POST /api/services/:id/complete` - å®Œæˆæœå‹™

## æ ¸å¿ƒæ¨¡çµ„èªªæ˜

### 1. ç—…æ‚£ç®¡ç† (Patient.ts)

é€™å€‹æ¨¡çµ„ä»¥å¸¶ tag çš„è¯åˆå‹åˆ¥å»ºæ¨¡ç‹€æ…‹ï¼Œä¸¦ä»¥è½‰æ›å‡½å¼é™åˆ¶å¯åŸ·è¡Œæ“ä½œã€‚

ç¯„ä¾‹ç‰‡æ®µï¼š

```ts
// ç‹€æ…‹å®šç¾©ï¼ˆç¯€éŒ„ï¼‰
export interface Registered { tag: 'Registered'; patientId: ID; registeredAt: DateTime; info: PatientInfo; }
export interface Admitted   { tag: 'Admitted';   patientId: ID; admittedAt: DateTime; wardNumber: string; bedNumber: string; attendingDoctorId: ID; info: PatientInfo; diagnoses: Diagnosis[]; }
export type PatientState = Registered | Admitted | Discharged | Referred | Deceased;

// ç‹€æ…‹è½‰æ›ï¼ˆåƒ…å…è¨± Registered â†’ Admittedï¼‰
export function admitPatient(patient: Registered, ward: string, bed: string, doctorId: ID): Result<Admitted> { /* é©—è­‰ â†’ success/failure */ }

// é¡å‹å®ˆè¡›
export function isAdmitted(p: PatientState): p is Admitted { return p.tag === 'Admitted'; }
```

### 2. é ç´„ç³»çµ± (Appointment.ts)

ä»¥æœ€å°åˆæ³•å–®ä½å»ºæ¨¡æ¯ä¸€æ­¥ï¼Œå‡½å¼åƒæ•¸å³ç‚ºå‰ç½®ç‹€æ…‹ï¼Œé¿å…éæ³•è½‰æ›ã€‚

ç¯„ä¾‹ç‰‡æ®µï¼š

```ts
// è«‹æ±‚ â†’ ç¢ºèª â†’ å ±åˆ° â†’ é–‹å§‹ â†’ å®Œæˆ
export function requestAppointment(patientId: ID, doctorId: ID, dept: string, time: TimeSlot, purpose: string): Result<Requested>;
export function confirmAppointment(appt: Requested, confirmationNumber: string): Result<Confirmed>;
export function checkInAppointment(appt: Confirmed): Result<CheckedIn>;
export function startAppointment(appt: CheckedIn): Result<InProgress>;
export function completeAppointment(appt: InProgress, followUpNeeded: boolean, notes?: string): Result<Completed>;

// æ™‚é–“çª—é©—è­‰ï¼ˆ30 åˆ†é˜ï¼‰å¤±æ•—æ™‚å›å‚³ failure
if (minutesDiff > 30) return failure(ErrorCode.ValidationFailed, 'Check-in time is outside the allowed window ...');
```

### 3. è—¥ç‰©è™•æ–¹ (Prescription.ts)

å±•ç¤º Created â†’ Submitted â†’ InPreparation â†’ Prepared â†’ Dispensed çš„ç·šæ€§æµç¨‹ï¼Œä¸¦ä»¥ `Result` å›å ±é©—è­‰éŒ¯èª¤ã€‚

ç¯„ä¾‹ç‰‡æ®µï¼š

```ts
// é–‹ç«‹è™•æ–¹ï¼ˆè‡³å°‘ 1 å€‹è—¥å“é …ç›®ï¼‰
export function createPrescription(patientId: ID, doctorId: ID, items: PrescriptionItem[], notes?: string): Result<Created> {
  if (items.length === 0) return failure(ErrorCode.ValidationFailed, 'Prescription must contain at least one medication item.');
  return success({ tag: 'Created', /* ... */ });
}

// åƒ… Submitted æ‰èƒ½é–‹å§‹èª¿åŠ‘
export function startPreparation(rx: Submitted, pharmacistId: ID): Result<InPreparation>;
```

### 4. é†«ç™‚æœå‹™ (MedicalService.ts)

ä½¿ç”¨å¸¸æ•¸ç‰©ä»¶ + å­—é¢é‡è¯åˆå–ä»£ enumï¼Œæ”¯æ´ Node ç›´è·‘ï¼›æ¯æ­¥é©Ÿçš†æª¢æ ¸å¿…è¦æ¢ä»¶ã€‚

ç¯„ä¾‹ç‰‡æ®µï¼š

```ts
// é¡åˆ¥èˆ‡å„ªå…ˆæ¬Šï¼ˆå–ä»£ enumï¼‰
export const ServiceType = { Consultation: 'Consultation', Examination: 'Examination', /* ... */ } as const;
export type ServiceType = typeof ServiceType[keyof typeof ServiceType];

// æ’ç¨‹ï¼ˆåƒ… Requested å¯æ’ç¨‹ï¼Œæ™‚é–“éœ€åœ¨æœªä¾†ï¼‰
export function scheduleService(svc: Requested, scheduledTime: DateTime, scheduledBy: ID, staff?: MedicalStaff[], location?: string): Result<Scheduled> {
  if (new Date(scheduledTime) <= new Date()) return failure(ErrorCode.ValidationFailed, 'Scheduled time must be in the future.');
  return success({ tag: 'Scheduled', /* ... */ });
}
```

---

## Result ADTï¼ˆçµ±ä¸€æˆåŠŸ/å¤±æ•—å›å‚³ï¼‰

```ts
export type Result<T> = Success<T> | Failure;
export function success<T>(data: T): Success<T> { return { success: true, data }; }
export function failure(code: ErrorCode, message: string, details?: Record<string, unknown>): Failure { return { success: false, error: { code, message, details } }; }
export function isSuccess<T>(r: Result<T>): r is Success<T> { return r.success === true; }
```

## è¨­è¨ˆé‡é»ï¼ˆç¨‹å¼é¢ï¼‰

- `Result<T>`ï¼šæˆåŠŸ/å¤±æ•—ä»¥ ADT è¡¨ç¤ºï¼ˆ`success`/`failure`ï¼‰ï¼Œçµ±ä¸€éŒ¯èª¤ç¢¼ `ErrorCode`ã€‚
- ç‹€æ…‹æ©Ÿï¼šä»¥å¸¶ `tag` çš„è¯åˆå‹åˆ¥æè¿°ç‹€æ…‹èˆ‡è½‰æ›ï¼Œé¿å…éæ³•è½‰æ›ã€‚
- é¡å‹å®ˆè¡›ï¼š`isXxx` è®“åˆ†æ”¯å…§è‡ªå‹•ç¸®å°å‹åˆ¥ï¼Œé¿å…æ–·è¨€ã€‚
- é›¶ä¾è³´ç›´è·‘ï¼šç”¨ const ç‰©ä»¶ + å­—é¢é‡è¯åˆå–ä»£ enumï¼Œç›¸å®¹ TypeScript ç·¨è­¯ã€‚

## æŠ€è¡“ç‰¹è‰²

âœ… **é¡å‹å®‰å…¨**ï¼šä½¿ç”¨ TypeScript çš„å¼·å‹åˆ¥ç³»çµ±ç¢ºä¿ç·¨è­¯æ™‚æœŸçš„éŒ¯èª¤æª¢æŸ¥  
âœ… **ç‹€æ…‹ç®¡ç†**ï¼šé€é ADT å¯¦ç¾æ¸…æ™°çš„ç‹€æ…‹è½‰æ›å’Œæ¥­å‹™é‚è¼¯  
âœ… **éŒ¯èª¤è™•ç†**ï¼šçµ±ä¸€çš„ Result é¡å‹è™•ç†æˆåŠŸå’Œå¤±æ•—æƒ…æ³  
âœ… **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šæ¸…æ™°çš„æ¨¡çµ„åˆ†å·¥å’Œè·è²¬åˆ†é›¢  
âœ… **ç¾ä»£åŒ–å‰ç«¯**ï¼šä½¿ç”¨ TailwindCSS å¯¦ç¾éŸ¿æ‡‰å¼è¨­è¨ˆ  
âœ… **RESTful API**ï¼šæ¨™æº–çš„ REST API è¨­è¨ˆï¼Œæ˜“æ–¼æ“´å±•å’Œç¶­è­·

## æˆæ¬Š

ISC License